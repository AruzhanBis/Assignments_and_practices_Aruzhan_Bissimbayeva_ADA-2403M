#include <mpi.h>                                   // Подключаем библиотеку MPI для распределенных вычислений
#include <iostream>                                // Подключаем библиотеку ввода-вывода
#include <vector>                                  // Подключаем библиотеку для работы с динамическими массивами

int main(int argc, char** argv) {
    MPI_Init(&argc, &argv);                        // Инициализируем среду MPI
    int rank, size;                                // Объявляем переменные для номера процесса и их общего количества
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);          // Получаем номер текущего процесса (от 0 до size-1)
    MPI_Comm_size(MPI_COMM_WORLD, &size);          // Получаем общее количество запущенных процессов

    long N_total = 10000000;                       // Определяем общий размер данных для обработки (10 миллионов)
    long N_local = N_total / size;                 // Вычисляем размер порции данных для каждого конкретного процесса
    std::vector<double> data(N_local, 1.0);        // Создаем локальный массив и заполняем его единицами

    double start_time = MPI_Wtime();               // Засекаем время начала выполнения вычислений на текущем процессе
    double local_sum = 0;                          // Переменная для хранения промежуточной суммы процесса
    for (long i = 0; i < N_local; i++) local_sum += data[i]; // Выполняем суммирование локальной части массива

    double global_sum = 0;                         // Переменная для хранения итогового результата (только для rank 0)
    // Собираем локальные суммы со всех процессов в одну общую global_sum на процессе rank 0
    MPI_Reduce(&local_sum, &global_sum, 1, MPI_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD);

    double end_time = MPI_Wtime();                 // Засекаем время окончания вычислений и коммуникаций
    double duration = end_time - start_time;       // Вычисляем затраченное время

    if (rank == 0) {                               // Только главный процесс (rank 0) отвечает за вывод
        // Выводим только конкретные данные теста (количество ядер и время)
        std::cout << "   Процессов: " << size << " | Время: " << duration << " сек." << std::endl;
    }

    MPI_Finalize();                                // Завершаем работу с MPI и освобождаем ресурсы
    return 0;                                      // Выход из программы
}
